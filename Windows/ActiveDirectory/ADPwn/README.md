# ADPwn

ADPwn - кроссплатформенный сканер уязвимостей Active Directory.

Утилита выводит результаты в консоль, а также генерирует JSON файл для импорта на pentest.local.

**Примечание:**

- Если в JSON файле присутствуют записи с пустым значением IP-адреса (null), pentest.local не сможет их обработать. Такие данные необходимо удалить вручную перед импортом.
- Предпочтительнее использовать на Windows, так как на Linux не работают проверки RBCD, ESC1-4, 13 и ACL.

# Установка

## Linux

Необходимо установить mono

```bash
sudo apt install mono-devel
```

Добавить контроллер домена в `/etc/hosts`

```
# Example
<dc-ip> DC.COMPANY.LAB DC COMPANY.LAB COMPANY
```


## Windows

Устанавливать ничего не нужно.
Если утилита используется на хосте, которая не входит в домен, то необходимо добавить контроллер домена в файл `hosts`

```
# Example
<dc-ip> DC.COMPANY.LAB DC COMPANY.LAB COMPANY
```

# Использование

```bash
# Usage
ADPwn.exe -u <[DOMAIN\]username> -p <password> -d <domain> -dc-ip <dc-ip>

# Linux
mono ADPwn.exe -u 'COMPANY\user' -p 'P@ssw0rd' -d 'company.lab' -dc-ip '100.64.0.30'
./ADPwn.exe -u 'COMPANY\user' -p 'P@ssw0rd' -d 'company.lab' -dc-ip '100.64.0.30'

# Windows
ADPwn.exe -u 'COMPANY\user' -p 'P@ssw0rd' -d 'company.lab' -dc-ip '100.64.0.30'
```

# Список проверок

## Recon

1. Список хостов
2. Список DC
3. Список портов (определяются по SPN записям)
3. Список пользователей
4. Список групп
5. Список OU
6. Список GPO
7. Список делегирований (проверка RBCD не работает на Linux)
8. Список MSSQL серверов
9. Список трастов

## Stale Object

1. Список хостов с устаревшей ОС
2. Проверка обновления контроллера домена
3. Список пользователей с флагом PASSWD_NOTREQD
4. Список пользователей с бессрочным паролем
5. Значение атрибута ms-DS-MachineAccountQuota
6. Проверка использования старого протокола NTLM
7. Проверка использования слабого алгоритма шифрования DES

## Roast

1. ASREPRoast
2. KERBERoast

## Privileged Accounts

1. Список администраторов доступных для делегирования
2. Список хостов с неограниченным делегированием
3. Список паролей LAPS (нужны права администратора для чтения атрибутов)

## ESC

1. Проверяется ESC8 (нужно доработать, не проверяется атрибут Request Disposition (проверяется через WMI или т.п.))
2. Если обнаружен ADCS, то выполняется проверка ESC 1-4, 13 (не работает на Linux)

## ACL

1. Проверяются права текущего пользователя к другим объектам (не работает на Linux)